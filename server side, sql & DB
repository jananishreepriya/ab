<?php
session_start();
$conn = new mysqli("localhost","root","","school_db");
if($conn->connect_error) die("Connection failed: ".$conn->connect_error);

$error = $success = "";

// ------------------------
// Teacher Register
// ------------------------
if(isset($_POST["register"])){
    $name = trim($_POST["name"]);
    $email = trim($_POST["email"]);
    $password = trim($_POST["password"]);

    if(!$name || !$email || !$password){
        $error = "All fields required!";
    } else {
        $stmt = $conn->prepare("INSERT INTO teachers (name,email,password) VALUES (?,?,?)");
        $stmt->bind_param("sss",$name,$email,$password);
        if($stmt->execute()) $success="Registration successful! Login below.";
        else $error="Error: ".$stmt->error;
    }
}

// ------------------------
// Teacher Login
// ------------------------
if(isset($_POST["login"])){
    $email = trim($_POST["email"]);
    $password = trim($_POST["password"]);

    if(!$email || !$password){
        $error="All fields required!";
    } else {
        $stmt = $conn->prepare("SELECT id,name,password FROM teachers WHERE email=?");
        $stmt->bind_param("s",$email);
        $stmt->execute();
        $result = $stmt->get_result();
        if($row=$result->fetch_assoc()){
            if($password === $row["password"]){
                $_SESSION["teacher_id"]=$row["id"];
                $_SESSION["teacher_name"]=$row["name"];
                header("Location: ?dashboard=1");
                exit();
            } else $error="Invalid password!";
        } else $error="No teacher found!";
    }
}

// ------------------------
// Logout
// ------------------------
if(isset($_GET["logout"])){
    session_destroy();
    header("Location: teacher_student.php");
    exit();
}

// ------------------------
// Dashboard
// ------------------------
if(isset($_GET["dashboard"]) && isset($_SESSION["teacher_id"])){

    // Add student
    if(isset($_POST["add_student"])){
        $sname = trim($_POST["sname"]);
        $sage = trim($_POST["sage"]);
        $smarks = trim($_POST["smarks"]);

        if(!$sname || !$sage || !$smarks){
            $error="All fields required!";
        } elseif(!is_numeric($sage) || $sage<=0){
            $error="Age must be positive!";
        } elseif(!is_numeric($smarks) || $smarks<0 || $smarks>100){
            $error="Marks must be 0-100!";
        } else {
            $stmt = $conn->prepare("INSERT INTO students (name,age,marks) VALUES (?,?,?)");
            $stmt->bind_param("sid",$sname,$sage,$smarks);
            if($stmt->execute()) $success="Student added!";
            else $error="Error: ".$stmt->error;
        }
    }

    // Student stats
    $min = $conn->query("SELECT MIN(marks) AS v FROM students")->fetch_assoc()["v"];
    $max = $conn->query("SELECT MAX(marks) AS v FROM students")->fetch_assoc()["v"];
    $avg = $conn->query("SELECT AVG(marks) AS v FROM students")->fetch_assoc()["v"];
    $count = $conn->query("SELECT COUNT(*) AS v FROM students")->fetch_assoc()["v"];
    $res = $conn->query("SELECT * FROM students");

    echo "<h2>Welcome, ".$_SESSION["teacher_name"]." ðŸ‘‹</h2>";

    echo "<h3>Add Student</h3>
    <form method='post'>
    Name: <input type='text' name='sname' required>
    Age: <input type='number' name='sage' required>
    Marks: <input type='number' step='0.01' name='smarks' required>
    <button type='submit' name='add_student'>Add</button>
    </form>
    <p style='color:red;'>$error</p>
    <p style='color:green;'>$success</p>";

    echo "<h3>Student Stats</h3>
    <p>Min Marks: $min</p>
    <p>Max Marks: $max</p>
    <p>Average Marks: ".round($avg,2)."</p>
    <p>Total Students: $count</p>";

    echo "<h3>All Students</h3><table border=1 cellpadding=5>
    <tr><th>ID</th><th>Name</th><th>Age</th><th>Marks</th></tr>";
    while($r=$res->fetch_assoc()){
        echo "<tr><td>{$r['id']}</td><td>{$r['name']}</td><td>{$r['age']}</td><td>{$r['marks']}</td></tr>";
    }
    echo "</table><br><a href='?logout=1'>Logout</a>";
    exit();
}
?>

<!DOCTYPE html>
<html>
<head><title>Teacher Portal</title></head>
<body>
<h2>Teacher Portal</h2>

<h3>Register</h3>
<form method="post">
    Name: <input type="text" name="name" required><br><br>
    Email: <input type="email" name="email" required><br><br>
    Password: <input type="password" name="password" required><br><br>
    <button type="submit" name="register">Register</button>
</form>

<h3>Login</h3>
<form method="post">
    Email: <input type="email" name="email" required><br><br>
    Password: <input type="password" name="password" required><br><br>
    <button type="submit" name="login">Login</button>
</form>

<p style="color:red;"><?= $error ?></p>
<p style="color:green;"><?= $success ?></p>
</body>
</html>

MYADMINPHP

CREATE DATABASE school_db;
USE school_db;

-- Teacher table
CREATE TABLE teachers (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    password VARCHAR(100) NOT NULL
);

-- Students table
CREATE TABLE students (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    age INT NOT NULL,
    marks DECIMAL(5,2) NOT NULL
);
